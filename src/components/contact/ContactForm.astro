---
// âœ… å»ºè®®å†™æ³•ï¼šä¼˜å…ˆä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½® API åŸºåœ°å€ï¼Œæ–¹ä¾¿ä»¥ååˆ‡æ¢åˆ° Cloudflare / æ–°åŸŸå
// åœ¨ .env æˆ– .env.production ä¸­é…ç½®ï¼šPUBLIC_LEAD_API=https://api.geo-max.ai æˆ– https://api.oldriver.work
const ACTION_URL =
  (import.meta.env.PUBLIC_LEAD_API_EN?.replace(/\/$/, '') || 'https://geo-max.tech') +
  '/lead-collect?json=1';
---

<section aria-labelledby="contact-form" class="relative">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16 lg:pb-20">
    <!-- æ …æ ¼ï¼šxl æ‰åˆ†ä¸¤åˆ—ï¼Œé¿å…åœ¨è¾ƒå°å±å¹•å‡ºç°å¤§é¢ç§¯ç•™ç™½ -->
    <div class="grid gap-8 md:grid-cols-1 xl:grid-cols-12 md:gap-10 xl:gap-14 items-start">

      <!-- å·¦ï¼šè¯´æ˜åŒºï¼ˆ4åˆ—ï¼‰ -->
      <div class="xl:col-span-4">
        <h2 id="contact-form" class="text-2xl font-semibold text-slate-900 dark:text-slate-100">
          Contact GEO-Max
        </h2>
        <p class="mt-3 text-slate-600 dark:text-slate-300 leading-relaxed">
          Tell us what you want to rank for in AI search.  
          Weâ€™ll reply within <span class="font-medium">1â€“2 business days</span>.
        </p>

        <!-- å¯é€‰ï¼šè¡¥å……è¦ç‚¹ï¼Œå‡å°‘å·¦ä¾§â€œç©ºç™½æ„Ÿâ€ -->
        <ul class="mt-6 space-y-3 text-slate-600 dark:text-slate-300">
          <li class="flex gap-2"><span>âœ…</span><span>English / Chinese supported</span></li>
          <li class="flex gap-2"><span>ğŸ”’</span><span>Your info stays private</span></li>
          <li class="flex gap-2"><span>âš¡</span><span>Pilot projects can start fast</span></li>
        </ul>
      </div>

      <!-- å³ï¼šè¡¨å•ï¼ˆ8åˆ—ï¼‰ -->
      <div class="xl:col-span-8 xl:ml-auto w-full">
        <div
          class="rounded-3xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/60 shadow-sm p-6 lg:p-8 backdrop-blur"
        >
          <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-100">
            Submit your inquiry online
          </h3>

          <form
            id="lead-form"
            method="post"
            action={ACTION_URL}
            data-force-remote="1"
            class="mt-6 grid gap-5"
          >

            <!-- meta -->
            <input type="hidden" name="src" value="web_form_en" />
            <!-- æäº¤æ—¶é—´æˆ³ï¼šç”¨äºåç«¯åˆ¤æ–­æ˜¯å¦â€œç§’æäº¤â€ -->
            <input type="hidden" name="ts" value={Date.now()} />
            <!-- èœœç½ 1ï¼šæ­£å¸¸ç”¨æˆ·çœ‹ä¸åˆ°ï¼Œbot å®¹æ˜“è¸© -->
            <input
              type="text"
              name="company_website"
              class="hidden"
              tabindex="-1"
              autocomplete="off"
            />

            <div class="grid md:grid-cols-2 gap-5">
              <div>
                <label for="name" class="block text-sm font-medium mb-1">Name</label>
                <input
                  id="name"
                  name="name"
                  required
                  class="w-full rounded-xl border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400/60"
                  placeholder="Alice"
                />
              </div>
              <div>
                <label for="org" class="block text-sm font-medium mb-1">Company</label>
                <input
                  id="org"
                  name="org"
                  class="w-full rounded-xl border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400/60"
                  placeholder="Acme Inc."
                />
              </div>
            </div>

            <div>
              <label for="phone" class="block text-sm font-medium mb-1">Phone</label>
              <input
                id="phone"
                name="phone"
                type="tel"
                class="w-full rounded-xl border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400/60"
                placeholder="Phone (optional)"
              />
            </div>

            <div>
              <label for="email" class="block text-sm font-medium mb-1">Email</label>
              <input
                id="email"
                name="email"
                type="email"
                required
                class="w-full rounded-xl border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400/60"
                placeholder="Please enter your email address"
              />
            </div>

            <div>
              <label for="topic" class="block text-sm font-medium mb-1">Inquiry topic</label>
              <select
                id="topic"
                name="topic"
                required
                class="w-full rounded-xl border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400/60"
              >
                <option value="">Select a topic</option>
                <option>Run a GEO Score</option>
                <option>Content optimization</option>
                <option>Agency / partnership</option>
                <option>Other</option>
              </select>
            </div>

            <div>
              <label for="message" class="block text-sm font-medium mb-1">Your needs</label>
              <textarea
                id="message"
                name="message"
                required
                rows={5}
                class="w-full rounded-xl border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 px-3 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400/60"
                placeholder="Please describe your use case, target platforms, budget and expected timeline in as much detail as possible."
              ></textarea>
            </div>

            <div class="flex items-start gap-3">
              <input
                id="consent"
                name="consent"
                type="checkbox"
                class="mt-1 h-4 w-4 rounded border-slate-300 dark:border-slate-700"
              />
              <label for="consent" class="text-sm text-slate-600 dark:text-slate-300">
                I agree to receive follow-up emails or calls related to this inquiry.
              </label>
            </div>

            <!-- èœœç½ 2ï¼šé¢å¤–éšè—å­—æ®µ -->
            <div style="display:none;">
              <input name="website" autocomplete="off" />
            </div>

            <!-- å›¾å½¢éªŒè¯ç å·²ç§»é™¤ï¼Œä¾èµ–èœœç½ + æ—¶é—´æˆ³é˜²åƒåœ¾ -->

            <button
              id="submit-btn"
              type="submit"
              class="inline-flex items-center justify-center rounded-xl px-5 py-2.5 text-sm font-medium shadow-sm
                     bg-indigo-600 text-white hover:bg-indigo-500 active:translate-y-px transition"
            >
              Submit
            </button>

            <p
              id="submit-result"
              class="text-xs text-slate-500 dark:text-slate-400 mt-2"
            >
              We respect your privacy and will only use your information for this consultation.
            </p>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const formEl = document.getElementById("lead-form");
    if (!formEl || !(formEl instanceof HTMLFormElement)) {
      return;
    }

    const btnEl = document.getElementById("submit-btn");
    if (!btnEl || !(btnEl instanceof HTMLButtonElement)) {
      return;
    }

    const resultEl = document.getElementById("submit-result");

    formEl.addEventListener("submit", async (e) => {
      e.preventDefault();

      btnEl.disabled = true;
      const prev = btnEl.innerText;
      if (resultEl) {
        resultEl.textContent = "Submitting your request...";
      }

      try {
        const fd = new FormData(formEl);
        const body = new URLSearchParams();
        fd.forEach((value, key) => {
          body.append(
            key,
            typeof value === "string"
              ? value
              : value && "name" in value
              ? value.name
              : ""
          );
        });

        const isLocal =
          location.hostname === "localhost" ||
          location.hostname === "127.0.0.1";
        const forceRemote = formEl.getAttribute("data-force-remote") === "1";
        let action = formEl.getAttribute("action") || "";

        if (isLocal && !forceRemote) {
          action = "http://localhost:8787/lead-collect?json=1";
        }
        if (!action) {
          action = "/api/lead-collect?json=1";
        }

        const resp = await fetch(action, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8",
          },
          body,
        });

        if (!resp.ok) {
          const text = await resp.text().catch(() => "");
          console.error("Submit failed:", {
            url: action,
            status: resp.status,
            body: text,
          });
          throw new Error(
            "Network error " + resp.status + (text ? ": " + text : "")
          );
        }

        let data;
        try {
          data = await resp.json();
        } catch (e) {
          data = {};
        }

        btnEl.innerText = "Submitted";
        btnEl.disabled = true; // ä¸å†å…è®¸é‡å¤ç‚¹
        if (resultEl) {
          resultEl.textContent =
            "âœ… Submitted. Weâ€™ll get back to you soon.";
        }
        formEl.reset();
      } catch (err) {
        console.error(err);
        alert("Submission failed, please try again later.");
        btnEl.innerText = prev || "Submit";
        if (resultEl) {
          resultEl.textContent =
            "âŒ Submission failed, please try again later.";
        }
      } finally {
        btnEl.disabled = false;
      }
    });
  });
</script>




